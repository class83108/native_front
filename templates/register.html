<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>註冊</title>
	<script src="../static/js/urls.js"></script>
	<!--    bootstrap-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>
     <script src="../static/js/jquery.min.js" type="text/javascript"></script>
    <!--  我自己的css-->
  <link rel="stylesheet" href="../static/css/style.css">
<!--  google字型-->
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500&display=swap" rel="stylesheet">
  <!--icon-->
  <script src="https://kit.fontawesome.com/17c8650b26.js" crossorigin="anonymous"></script>
</head>
<body>
<!--header-->
  <header>
    <div class='container-fluid clear-padding-row'>
<!--      <div class="row">-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
<!--    <div class="">-->
    <a class="navbar-brand" href="#"><i class="fa-solid fa-feather-pointed"></i>台灣土種雞網</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
<!--    </div>-->
<!--    <div class="">-->
       <div class="collapse navbar-collapse" id="navbarSupportedContent">

      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">

        <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/native/templates/index.html">
            <i class="fa-solid fa-house-user"></i>回到首頁</a>
        </li>

<!--      最新消息    -->
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white">
            <i class="fa-solid fa-newspaper"></i>最新消息
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/native/templates/aiinfo.html?1">禽流感疫情資訊</a></li>
            <li><a class="dropdown-item" href="/native/templates/feedprice.html?1">進口原物料價格</a></li>
            <li><a class="dropdown-item" href="/native/templates/eggmeatprice.html?1">家禽產地交易行情</a></li>
          </ul>
            </li>
<!--雞種介紹-->

          <li class="nav-item dropdown">
          <span></span>
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white">
            <i class="fa-solid fa-egg"></i>雞種介紹
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/native/templates/breed_chicken.html">育種品系介紹</a></li>
            <li><a class="dropdown-item" href="/native/templates/conservation_chicken.html">保種品系介紹</a></li>
          </ul>
            </li>
<!--      研究成果    -->
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white">
            <i class="fa-solid fa-book"></i>研究成果
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/native/templates/article_Taiwan.html?1">台灣土雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_zaki.html?1">石岐雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_huadong.html?1">花東雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_kinmen.html?1">金門雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_silkie.html?1">絲羽烏骨雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_emei.html?1">峨嵋雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_takezaki.html?1">竹崎雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_faith.html?1">信義雞論文</a></li>
            <li><a class="dropdown-item" href="/native/templates/article_nagoya.html?1">名古屋雞論文</a></li>
          </ul>
            </li>
<!--          會員中心-->
          <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white">
            <i class="fa-solid fa-circle-user"></i>會員中心
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/native/templates/about.html">關於我</a></li>
            <li><a class="dropdown-item" href="/native/templates/change_info.html">更改會員資料</a></li>
            <li><a class="dropdown-item" href="/native/templates/forget_password.html">忘記密碼</a></li>
            <li><a class="dropdown-item" href="https://nativechicken-chatroom.herokuapp.com/chat/index/">台灣土種雞交流區</a></li>
          </ul>
            </li>
<!--          聯絡我們-->
          <li class="nav-item">
          <a class="nav-link active" aria-current="page" href="/native/templates/contact_us.html"><i class="fa-solid fa-square-phone-flip"></i>
            聯絡我們</a>
        </li>

<!--登入/註冊-->

          <li class="nav-item dropdown navbar-right">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:white">
           <i class="fa-solid fa-right-to-bracket"></i>登入/註冊
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="/native/templates/login.html">登入</a></li>
            <li><a class="dropdown-item" href="/native/templates/register.html">註冊</a></li>
            <div id="logout" style="display:none" ><li><a class="dropdown-item" href="#">登出</a></li></div>
              <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item github_login" href="#">GitHub登入</a></li>
          </ul>
            </li>

      </ul>
    </div>
<!--      </div>-->
  </div>
  </nav>
<!--  </div>-->

    </div>
 </header>
  <section class="vh-100" style="background-image:url('../static/images/pexels-alison-burrell-195226_2.jpg');background-position:0 -300px">
  <div class="container h-100">
    <div class="row d-flex justify-content-center h-100">
      <div class="col-lg-12 col-xl-11" style="margin-top:100px">
        <div class="card text-black" style="border-radius: 25px">
          <div class="card-body p-md-5">
               <div class="row justify-content-center align-items-center">
	<div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

<table class="table">
    <h2 style="margin-bottom:50px">建新帳號</h2>
     <tr><th scope="row">帳號</th>
         <td><input type="text" class="username" name="username" placeholder="請輸入帳號" required maxlength="11"/></td></tr>
    <tr><th scope="row">信箱</th>
        <td><input type="email" class="email" name="email" placeholder="請輸入信箱" required /></td></tr>
<tr><th scope="row">手機</th>
    <td><input type="phone" class="phone" name="phone" placeholder="請輸入手機"  onfocus="ShowFocus()" required/><div id="sms"></div></td></tr>
<tr><th scope="row">手機驗證碼</th>
    <td><input type="sms_num" class="sms_num" name="sms_num" placeholder="請輸入驗證碼" required /></td></tr>
<tr><th scope="row">密碼</th>
    <td><input type="password" class="password_1" name="password_1" placeholder="請輸入密碼" required minlength="6" maxlength="12"/></td></tr>
<tr><th scope="row">確認密碼</th>
    <td><input type="password" class="password_2" name="password_2" placeholder="請再次確認密碼" required minlength="6" maxlength="11"/></td></tr>
</table>
    <input style="margin-bottom:20px" type="button" value="創建與登入" onclick="register()">

        <div style="margin-top:20px;"><a class="github_login" style="color:#0072E3">不想填寫資料嗎?直接使用Github登入</a></div>
                        </div>

    <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">
        <img src="../static/images/pexels-quang-nguyen-vinh-2134180.jpg" class="img-fluid" alt="Sample image" style="border-radius: 25px;">
    </div>
      </div></div></div>
    </div></div>
  </div>
</section>
</body>
<script>
function register(){
    var username = $('.username').val();
    var email = $('.email').val();
    var password_1 = $('.password_1').val();
	var password_2 = $('.password_2').val();
	var phone = $('.phone').val();
	var sms_num = $('.sms_num').val();
	var post_data = {"username":username, "email":email, "password_1":password_1, "password_2":password_2, "phone":phone, "sms_num":sms_num};

    $.ajax({
        type:"post",
        contentType: 'application/json',
        dataType: 'json',
        data: JSON.stringify(post_data),
        url: `http://${HOST}:${PORT}/v1/users`,
        success: function(result){
        if (result.code==200){
        alert("註冊成功")
        window.location.href = '/native/templates/login.html'
        }
        else{
        alert(result.error)
        }
        }
    })
    }

function ShowFocus() {
  document.querySelector('#sms').innerHTML = '<input type="button" onclick="sendSMS();settime(this)" value="獲取驗證碼">'
        }

function sendSMS(){
    var phone = $('.phone').val();
    console.log(phone);

    var post_data = {'phone':phone}
    $.ajax({
    type:'post',
    contentType:'application/json',
    dataType:'json',
    url:`http://${HOST}:${PORT}/v1/users/sms/sms`,
    data:JSON.stringify(post_data),
    beforeSend: function(){
    if ($('.phone').val() == ''){alert('請輸入手機號碼');return false;}
    },
    success: function(result){
    if(result.code==200){
    alert("簡訊已發送，請查收")
    }
    else{
    alert(result.error);
    }
    }
    })
}

var countdown=60;
	function settime(obj) {
    	if (countdown == 0) {
        	obj.removeAttribute("disabled");
        	obj.value="獲取驗證碼";
			countdown = 60;
        	return;
    	} else {
        	obj.setAttribute("disabled", true);
        	obj.value="重新發送(" + countdown + ")";
        	countdown--;
    	}
		setTimeout(function() {
    		settime(obj) }
    	,1000)
	}
	var token = window.localStorage.getItem('token');
    var username = window.localStorage.getItem('user');
	if (token){
        logout = document.getElementById("logout")
        logout.style.display="block"
    }
        $('#logout').click(function(){

            if(confirm("確定登出嗎？")){
                window.localStorage.removeItem('token');
                window.localStorage.removeItem('user');
                window.location.href= '/native/templates/index.html';
            }
        })
$('.github_login').click(function(){
    $.ajax({
    type:'get',
    url:`http://${HOST}:${PORT}/v1/users/github/authorization`,
    success:function(response){
    if(200==response.code){
        console.log(response)
        console.log('go to github')
        window.location.href=response.oauth_url
    }else{
    alert('服務器異常')
                   }
                }
    })
    })
</script>

</html>